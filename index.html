<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Matrix</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #1a1a1a;
            color: white;
        }
        .container {
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            cursor: pointer;
            background: #0088cc;
            color: white;
            font-size: 16px;
            border-radius: 5px;
        }
        button:hover {
            background: #005f99;
        }
        .team {
            margin-top: 20px;
            padding: 10px;
            background: #333;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TON Matrix</h1>
        <p><strong>–í–∞—à Telegram ID:</strong> <span id="userId">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <button id="connectWallet">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å TON-–∫–æ—à–µ–ª–µ–∫</button>

        <h2>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</h2>
        <button id="register">‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        <p><strong>–í–∞—à–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã:</strong> <span id="referrals">0</span></p>

        <h2>–ö—É–ø–∏—Ç—å —Å—Ç–∞—Ç—É—Å</h2>
        <button onclick="buyStatus(1)">üíé –ö—É–ø–∏—Ç—å –∑–∞ 3 TON</button>
        <button onclick="buyStatus(2)">üî• –ö—É–ø–∏—Ç—å –∑–∞ 10 TON</button>
        <button onclick="buyStatus(3)">üöÄ –ö—É–ø–∏—Ç—å –∑–∞ 20 TON</button>

        <h2>–ú–æ—è –∫–æ–º–∞–Ω–¥–∞</h2>
        <div id="team" class="team">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const tonConnect = new TONConnect();
        const contractAddress = "YOUR_CONTRACT_ADDRESS"; // –£–∫–∞–∂–∏ —Å–≤–æ–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç
        const adminWallet = "UQCB1eRpWSKN839on6Uns7mCSLoDTEbSZlkw9bDipC83OLFT"; // –ö–æ—à–µ–ª–µ–∫ –¥–ª—è 10%

        let userId = "–ì–æ—Å—Ç—å";
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            userId = "tg_" + tg.initDataUnsafe.user.id;
        }
        document.getElementById("userId").textContent = userId;

        async function connectWallet() {
            try {
                await tonConnect.connect();
                alert("‚úÖ –ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω!");
            } catch (err) {
                alert("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: " + err.message);
            }
        }

        async function register() {
            let inviterId = new URLSearchParams(window.location.search).get("ref") || "0";

            try {
                let tx = await tonConnect.invokeTonApi({
                    address: contractAddress,
                    method: "register",
                    params: [inviterId],
                });
                alert("‚úÖ –í—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã! TX: " + tx);
            } catch (err) {
                alert("‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: " + err.message);
            }
        }

        async function buyStatus(level) {
            let price = level === 1 ? 3 : level === 2 ? 10 : 20;

            try {
                let balance = await tonConnect.getBalance();
                if (balance < price) {
                    alert("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON! –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å.");
                    return;
                }

                let tx = await tonConnect.invokeTonApi({
                    address: contractAddress,
                    method: "buyStatus",
                    params: [level],
                    value: price.toString(),
                });

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º 10% –∞–¥–º–∏–Ω—É
                let adminFee = price * 0.1;
                await tonConnect.invokeTonApi({
                    address: adminWallet,
                    method: "transfer",
                    params: [],
                    value: adminFee.toString(),
                });

                alert("üéâ –°—Ç–∞—Ç—É—Å –∫—É–ø–ª–µ–Ω! TX: " + tx);
            } catch (err) {
                alert("‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏: " + err.message);
            }
        }

        document.getElementById("connectWallet").addEventListener("click", connectWallet);
        document.getElementById("register").addEventListener("click", register);
    </script>
</body>
</html>
